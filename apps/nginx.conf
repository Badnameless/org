server {
  listen 80;
  server_name localhost;

  # Root directory for the Angular app
  # This path should match the destination in your Dockerfile's COPY command
  root /usr/share/nginx/html/browser;
  index index.html index.htm;

  location / {
    # Try to serve the requested file directly, then try it as a directory,
    # finally, fall back to index.html for SPA routing.
    # This is crucial for Angular's client-side routing to work correctly.
    try_files $uri $uri/ /index.html;
  }

  # Optional: Add caching headers for static assets to improve performance.
  # Browsers will cache these files for a long time.
  # Ensure your build process generates unique filenames for assets if content changes (e.g., using hashes).
  location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|svg|woff|woff2|ttf|eot|json)$ {
    expires 1y;
    add_header Cache-Control "public";
    access_log off; # Optional: disable access logging for static assets
  }

  # Optional: Enable Gzip compression for text-based files to reduce transfer size.
  gzip on;
  gzip_vary on; # Adds a Vary: Accept-Encoding header
  gzip_proxied any; # Compress for all proxied requests
  gzip_comp_level 6; # Compression level (1-9)
  gzip_buffers 16 8k; # Number and size of buffers
  gzip_http_version 1.1; # Minimum HTTP version
  gzip_min_length 256; # Don't compress anything smaller than 256 bytes
  gzip_types
    text/plain
    text/css
    text/xml
    application/json
    application/javascript
    application/x-javascript
    application/xml
    application/rss+xml
    image/svg+xml;

  # Optional: Security headers (add or modify as needed)
  # add_header X-Frame-Options "SAMEORIGIN" always;
  # add_header X-XSS-Protection "1; mode=block" always;
  # add_header X-Content-Type-Options "nosniff" always;
  # add_header Referrer-Policy "strict-origin-when-cross-origin" always;
  # add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';" always;
  # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;


  # Optional: Basic error pages
  error_page 404 /index.html; # Redirect 404s to index.html for SPAs
  error_page 500 502 503 504 /50x.html;
  location = /50x.html {
    root /usr/share/nginx/html; # Or a different location for custom error pages
  }
}
